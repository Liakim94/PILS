<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.xicom.cms.service.mapper.CodeMapper">
    <resultMap id="codeVO" type="code">
        <result property="ctgr"     column="CTGR"   />
        <result property="cd"       column="CD"     />
        <result property="cdNm"     column="CD_NM"  />
        <result property="cdDesc"   column="CD_DESC"/>
        <result property="rsv1"     column="RSV1"   />
        <result property="rsv2"     column="RSV2"   />
        <result property="rsv3"     column="RSV3"   />
        <result property="sort"     column="SORT"   />
        <result property="useAt"    column="USE_AT" />
    </resultMap>
    
    <select id="getCategoryList"  resultMap="codeVO" useCache="true">
        SELECT CD_GRP   AS ctgr         
        , CD            AS cd           
        , CD_NM         AS cd_nm            
        , CD_EXPLNT     AS cd_desc          
        , RSVTN_ONE     AS rsv1         
        , RSVTN_TWO     AS rsv2         
        , RSVTN_THREE   AS rsv3         
        , SORT          AS sort         
        , USE_AT        AS use_at           
          FROM TB_CD_DATA
         WHERE CD_GRP = '00000'
         ORDER BY SORT ASC
    </select>
    
    <select id="getCodeList" resultMap="codeVO" useCache="true">
        SELECT CD_GRP   AS ctgr         
        , CD            AS cd           
        , CD_NM         AS cd_nm            
        , CD_EXPLNT     AS cd_desc          
        , RSVTN_ONE     AS rsv1         
        , RSVTN_TWO     AS rsv2         
        , RSVTN_THREE   AS rsv3         
        , SORT          AS sort         
        , USE_AT        AS use_at       
          FROM TB_CD_DATA
         WHERE CD_GRP = #{ctgr}
         <if test='!useAt.equals("")'>
           AND USE_AT = #{useAt}
         </if>
         ORDER BY SORT ASC
    </select>
    
    <select id="getCodeById"  resultMap="codeVO" useCache="true">
        SELECT CD_GRP   AS ctgr         
        , CD            AS cd           
        , CD_NM         AS cd_nm            
        , CD_EXPLNT     AS cd_desc          
        , RSVTN_ONE     AS rsv1         
        , RSVTN_TWO     AS rsv2         
        , RSVTN_THREE   AS rsv3         
        , SORT          AS sort         
        , USE_AT        AS use_at       
          FROM TB_CD_DATA
         WHERE CD_GRP   = #{ctgr }
           AND CD       = #{cd }
    </select>
    
    <update id="addCode" flushCache="true">
        INSERT INTO tb_cd_data(CD_GRP, CD, CD_NM, CD_EXPLNT, RSVTN_ONE, RSVTN_TWO, RSVTN_THREE, SORT, USE_AT)
        VALUES( #{ctgr }, #{cd }, #{cdNm }, #{cdDesc }, #{rsv1}, #{rsv2}, #{rsv3}, #{sort}::INT8, #{useAt} )
    </update>
     
    <update id="updateCode" flushCache="true">
        UPDATE TB_CD_DATA
           SET  CD      = #{cd }
            , CD_NM     = #{cdNm }
            , CD_EXPLNT     = #{cdDesc }
            , RSVTN_ONE         = #{rsv1 }
            , RSVTN_TWO         = #{rsv2 }
            , RSVTN_THREE       = #{rsv3 }
            , SORT      = #{sort }::INT8
            , USE_AT    = #{useAt }
        WHERE CD_GRP        = #{ctgr }
        AND CD = #{cd }
    </update>
    
    <update id="updateCodeSort" flushCache="true">
        UPDATE TB_CD_DATA SET SORT = #{sort}::INT8
         WHERE CD_GRP = #{ctgr} 
           AND CD = #{cd}
    </update>

</mapper>
