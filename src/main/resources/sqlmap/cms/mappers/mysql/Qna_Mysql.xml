<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.xicom.cms.service.mapper.QnaMapper">

    <resultMap type="default" id="default">
        <result property="regSeq"       column="REG_SEQ"        />
        <result property="regNm"        column="REG_NM"         />
        <result property="regDe"        column="REG_DE"         />
        <result property="regIp"        column="REG_IP"         />
        
        <result property="updSeq"       column="UPD_SEQ"        />
        <result property="updNm"        column="UPD_NM"         />
        <result property="updDe"        column="UPD_DE"         />
        <result property="updIp"        column="UPD_IP"         />
        
        <result property="stat"         column="STAT"           />
    </resultMap>

    <resultMap type="kr.co.xicom.front.model.BbsQnaVO"      id="bbsQna" extends="default">
        <result property="no"                               column="no"/>
        <result property="headnum"                          column="headnum"/>
        <result property="arrangenum"                       column="arrangenum"/>
        <result property="depth"                            column="depth"/>
        <result property="id"                               column="id"/>
        <result property="name"                             column="name"/>
        <result property="passwd"                           column="passwd"/>
        <result property="title"                            column="title"/>   
        <result property="body"                             column="body"/>
        <result property="ip"                               column="ip"/>
        <result property="rdate"                            column="rdate"/>
        <result property="reply"                            column="reply"/>
        <result property="replyDe"                          column="replyDe"/>
        
    </resultMap>
    
    <select id="list" resultMap="bbsQna">
        select NO               AS no           
                , HEDOFC_NO     AS headnum      
                , SORT_NO       AS arrangenum   
                , DP            AS depth        
                , ID            AS id           
                , NM            AS name     
                , PSWD          AS passwd       
                , TTL           AS title        
                , TO_CHAR(TO_TIMESTAMP(REGIST_DATE), 'YYYY-MM-DD') AS rdate
                , RSPNS         AS reply
        from TB_BANNER_QUST_ANSWR
        where 1=1 
        <if test="!id.equals('')">
            and ID = #{id}
        </if>
        <choose>
        <when test='stat == "n"'>
           and RSPNS IS NULL
        </when>
        <otherwise>
           and RSPNS NOTNULL
        </otherwise>
        </choose>
        <if test="searchKeyword != ''">
        AND (TTL LIKE CONCAT('%', #{searchKeyword}, '%') OR BDTXT LIKE CONCAT('%', #{searchKeyword}, '%')) 
        </if>   
        order by NO DESC
        <if test="pageIndex > 0">
        LIMIT #{pageUnit} OFFSET #{firstIndex}  
        </if>
    </select>
    
    <select id="listCnt" resultType="int">
        select count(1)cnt
        from TB_BANNER_QUST_ANSWR
        where 1=1 
        <if test="!id.equals('')">
            and ID = #{id}
        </if>
        <choose>
        <when test='stat == "n"'>
           and RSPNS IS NULL
        </when>
        <otherwise>
           and RSPNS IS NULL
        </otherwise>
        </choose>
        <if test="searchKeyword != ''">
        AND (TTL LIKE CONCAT('%', #{searchKeyword}, '%') OR BDTXT LIKE CONCAT('%', #{searchKeyword}, '%')) 
        </if>   
    </select>
    
    <select id="getBbsQnabyId" resultMap="bbsQna">
        select NO               AS no           
                , HEDOFC_NO     AS headnum          
                , SORT_NO       AS arrangenum       
                , DP            AS depth            
                , ID            AS id           
                , NM            AS name         
                , PSWD          AS passwd           
                , TTL           AS title            
                , BDTXT         AS body         
                , RSPNS         AS reply            
                , RSPNS_DATE    AS replyde          
        from TB_BANNER_QUST_ANSWR
        where 1=1 
        and NO = #{no}::INT8
    </select>
    
    <update id="updateBbsQna">
        update TB_BANNER_QUST_ANSWR set 
          RSPNS = #{reply}
          , RSPNS_DATE = now()
        where NO = #{no}::INT8
    </update>
</mapper>
