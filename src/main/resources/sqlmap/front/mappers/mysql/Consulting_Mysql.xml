<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.xicom.front.service.mapper.ConsultingMapper">

<resultMap id="CmpMemberVo"        type="kr.co.xicom.front.model.CmpMemberVo">
    <result property="bizNo"              column="bizNo"/>
    <result property="mem_cd"             column="mem_cd"/>
    <result property="cmpNm"              column="cmpNm"/>
    <result property="fdate"              column="fdate"/>
    <result property="ceo"                column="ceo"/>
    <result property="address"            column="address"/>
    <result property="address_dtl"        column="address_dtl"/>
    <result property="telNo"              column="telNo"/>
    <result property="faxNo"              column="faxNo"/>
    <result property="bizType"            column="bizType"/>
    <result property="capital"            column="capital"/>
    <result property="product"            column="product"/>
    <result property="conQ"              column="conQ"/>
    <result property="deal_type"         column="deal_type"/>
    <result property="deal_scale"        column="deal_scale"/>
    <result property="material"          column="material"/>
    <result property="appdate"           column="appdate"/>
    <result property="name"              column="name"/>
    <result property="deptNm"            column="deptNm"/>
    <result property="position"          column="position"/>
    <result property="mbphno"            column="mbphno"/>
    <result property="email"             column="email"/>
    <result property="memTelNo"          column="memTelNo"/>
    <result property="memFaxNo"          column="memFaxNo"/>
</resultMap>

    <insert id="insertConsulting">
        insert into tb_pils_cmpmbr
        (cmp_nm
        ,bizno
        ,cmp_mbr_cd
        ,ceo
        ,fdate
        ,addr
        ,addr_dtl
        ,telno
        ,faxno
        ,biz_ty
        ,capl
        ,deal_ty
        ,yr_deal_scale
        ,prmy_mat
        ,con_q)
        values (
                   #{cmpNm}
               , #{bizNo}
               ,'01'
               ,#{ceo}
               ,#{fdate}
               ,#{address}
               ,#{address_dtl}
               ,#{telNo}
               ,#{faxNo}
               ,#{bizType}
               ,#{capital}
               ,#{deal_type}
               ,#{deal_scale}
               ,#{material}
               ,#{conQ}
    )
    </insert>
    <insert id="insertMemberInfo">
        insert into tb_pils_mbr
        (nm
        ,mbphno
        ,psitn_dept_nm
        ,pstn
        ,email_addr
        ,telno
        ,faxno
        ,auth_cd
        ,bizno
        ,user_id
        ,pswd
        )
        values (
               #{name}
               ,#{mbphno}
               ,#{deptNm}
               ,#{position}
               ,#{email}
               ,#{memTelNo}
               ,#{memFaxNo}
               ,'2'
               ,#{bizNo}
               ,#{id}
               ,encode(encrypt(convert_to(#{passwd}, 'utf8'), 'ENC_KEY', 'aes'), 'hex')
               )
    </insert>
    <select id="list" resultMap="CmpMemberVo">
        select
              A.bizno as bizNo
             ,A.cmp_mbr_cd as mem_cd
             ,A.cmp_nm as  cmpNm
             ,substring (A.appdt::varchar, 1, 10) as appdate
             ,B.nm as name
             ,B.user_id as id
             ,B.pswd as passwd

        from tb_pils_cmpmbr A join tb_pils_mbr B
            on A.bizno =B.bizno
        where cmp_mbr_cd='01'
        order by appdt desc
        <if test="pageIndex > 0">
            LIMIT #{pageUnit} OFFSET #{firstIndex}
        </if>
    </select>
    <select id="listCount" resultType="int" >
        SELECT COUNT(1)
        FROM tb_pils_cmpmbr A join tb_pils_mbr B
                                ON  A.bizno =B.bizno
        WHERE 1 = 1 and cmp_mbr_cd='01'

    </select>
    <select id="conChkPw" resultType="int" >
        select
            case when inPass = pswd then 1
                 else 0 end as rslt
        from
            (select
                 encode(encrypt(convert_to(#{passwd},'utf8'),'ENC_KEY','aes'),'hex') as inPass
                  , pswd
             from
                 tb_banner_qust_answr where no = #{no}
            ) a;

    </select>
</mapper>